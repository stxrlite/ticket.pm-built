{"version":3,"file":"createTicket.js","sourceRoot":"/","sources":["utils/createTicket.ts"],"names":[],"mappings":"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","sourcesContent":["import { ActionRowBuilder, ButtonBuilder, ButtonStyle, Collection, EmbedBuilder, ModalSubmitInteraction, PermissionFlagsBits, StringSelectMenuInteraction, TextInputComponent } from \"discord.js\";\nimport { log } from \"./logs\";\nimport {ExtendedClient, TicketType} from \"../structure\";\n\n/*\nCopyright 2023 Sayrix (github.com/Sayrix)\n\nLicensed under the Creative Commons Attribution 4.0 International\nplease check https://creativecommons.org/licenses/by/4.0 for more informations.\n*/\n\n/**\n * @param {Discord.Interaction} interaction\n * @param {Discord.Client} client\n * @param {Object} ticketType\n * @param {Object|string} reasons\n */\nexport const createTicket = async (interaction: StringSelectMenuInteraction | ModalSubmitInteraction, client: ExtendedClient, ticketType: TicketType, reasons?: Collection<string, TextInputComponent> | string) => {\n\tconst locale = client.locales;\n\t// eslint-disable-next-line no-async-promise-executor\n\treturn new Promise(async function (resolve, reject) {\n\t\tawait interaction.deferReply({ ephemeral: true }).catch((e) => console.log(e));\n\n\t\tconst reason: string[] = [];\n\t\tlet allReasons = \"\";\n\n\t\tif (typeof reasons === \"object\") {\n\t\t\treasons.forEach(async (r) => {\n\t\t\t\treason.push(r.value);\n\t\t\t});\n\t\t\tallReasons = reason.map((r, i) => `Question ${i + 1}: ${r}`).join(\", \");\n\t\t}\n\t\tif(typeof reasons === \"string\") allReasons = reasons;\n\n\t\tlet ticketName = \"\";\n\n\t\tlet ticketCount = (await client.prisma.$queryRaw<[{count: bigint}]>\n\t\t`SELECT COUNT(*) as count FROM tickets`)[0].count;\n\n\t\tif (ticketType.ticketNameOption) {\n\t\t\tticketName = ticketType.ticketNameOption\n\t\t\t\t.replace(\"USERNAME\", interaction.user.username)\n\t\t\t\t.replace(\"USERID\", interaction.user.id)\n\t\t\t\t.replace(\"TICKETCOUNT\", ticketCount.toString() ?? \"0\");\n\t\t} else {\n\t\t\tticketName = client.config.ticketNameOption\n\t\t\t\t.replace(\"USERNAME\", interaction.user.username)\n\t\t\t\t.replace(\"USERID\", interaction.user.id)\n\t\t\t\t.replace(\"TICKETCOUNT\", ticketCount.toString() ?? \"0\");\n\t\t}\n\t\tif(!interaction.guild) return console.error(\"Interaction createTicket was not executed in a guild\");\n\t\t\n\t\tconst channel = await client.guilds.cache.get(client.config.guildId)?.channels.create({\n\t\t\tname: ticketName,\n\t\t\tparent: ticketType.categoryId,\n\t\t\tpermissionOverwrites: [\n\t\t\t\t{\n\t\t\t\t\tid: interaction.guild.roles.everyone,\n\t\t\t\t\tdeny: [PermissionFlagsBits.ViewChannel],\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tif (!channel) return reject(\"Couldn't create the ticket channel.\");\n\t\tlog(\n\t\t\t{\n\t\t\t\tLogType: \"ticketCreate\",\n\t\t\t\tuser: interaction.user,\n\t\t\t\treason: allReasons,\n\t\t\t\tticketChannelId: channel.id\n\t\t\t},\n\t\t\tclient\n\t\t);\n\n\t\t// Client.db is set here and incremented ticket count\n\t\tticketCount++;\n\n\t\tawait channel.permissionOverwrites\n\t\t\t.edit(interaction.user, {\n\t\t\t\tSendMessages: true,\n\t\t\t\tAddReactions: true,\n\t\t\t\tReadMessageHistory: true,\n\t\t\t\tAttachFiles: true,\n\t\t\t\tViewChannel: true,\n\t\t\t})\n\t\t\t.catch((e) => console.log(e));\n\n\t\tif (client.config.rolesWhoHaveAccessToTheTickets.length > 0) {\n\t\t\tfor (const role of client.config.rolesWhoHaveAccessToTheTickets) {\n\t\t\t\tawait channel.permissionOverwrites\n\t\t\t\t\t.edit(role, {\n\t\t\t\t\t\tSendMessages: true,\n\t\t\t\t\t\tAddReactions: true,\n\t\t\t\t\t\tReadMessageHistory: true,\n\t\t\t\t\t\tAttachFiles: true,\n\t\t\t\t\t\tViewChannel: true,\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => console.log(e));\n\t\t\t}\n\t\t}\n\t\tconst footer = locale.getSubValue(\"embeds\", \"ticketOpened\", \"footer\", \"text\").replace(\"ticket.pm\", \"\");\n\t\tif(ticketType.color?.toString().trim() === \"\") ticketType.color = undefined;\n\t\tconst ticketOpenedEmbed = new EmbedBuilder({\n\t\t\tcolor: 0,\n\t\t})\n\t\t\t.setColor(ticketType.color ?? client.config.mainColor)\n\t\t\t.setTitle(locale.getSubValue(\"embeds\", \"ticketOpened\", \"title\").replace(\"CATEGORYNAME\", ticketType.name))\n\t\t\t.setDescription(\n\t\t\t\tticketType.customDescription\n\t\t\t\t\t? ticketType.customDescription\n\t\t\t\t\t\t.replace(\"CATEGORYNAME\", ticketType.name)\n\t\t\t\t\t\t.replace(\"USERNAME\", interaction.user.username)\n\t\t\t\t\t\t.replace(\"USERID\", interaction.user.id)\n\t\t\t\t\t\t.replace(\"TICKETCOUNT\", ticketCount.toString() || \"0\")\n\t\t\t\t\t\t.replace(\"REASON1\", reason[0])\n\t\t\t\t\t\t.replace(\"REASON2\", reason[1])\n\t\t\t\t\t\t.replace(\"REASON3\", reason[2])\n\t\t\t\t\t\t.replace(\"REASON4\", reason[3])\n\t\t\t\t\t\t.replace(\"REASON5\", reason[4])\n\t\t\t\t\t\t.replace(\"REASON6\", reason[5])\n\t\t\t\t\t\t.replace(\"REASON7\", reason[6])\n\t\t\t\t\t\t.replace(\"REASON8\", reason[7])\n\t\t\t\t\t\t.replace(\"REASON9\", reason[8])\n\t\t\t\t\t: locale.getSubValue(\"embeds\", \"ticketOpened\", \"description\")\n\t\t\t\t\t\t.replace(\"CATEGORYNAME\", ticketType.name)\n\t\t\t\t\t\t.replace(\"USERNAME\", interaction.user.username)\n\t\t\t\t\t\t.replace(\"USERID\", interaction.user.id)\n\t\t\t\t\t\t.replace(\"TICKETCOUNT\", ticketCount.toString() || \"0\")\n\t\t\t\t\t\t.replace(\"REASON1\", reason[0])\n\t\t\t\t\t\t.replace(\"REASON2\", reason[1])\n\t\t\t\t\t\t.replace(\"REASON3\", reason[2])\n\t\t\t\t\t\t.replace(\"REASON4\", reason[3])\n\t\t\t\t\t\t.replace(\"REASON5\", reason[4])\n\t\t\t\t\t\t.replace(\"REASON6\", reason[5])\n\t\t\t\t\t\t.replace(\"REASON7\", reason[6])\n\t\t\t\t\t\t.replace(\"REASON8\", reason[7])\n\t\t\t\t\t\t.replace(\"REASON9\", reason[8])\n\t\t\t)\n\t\t\t.setFooter({\n\t\t\t\t// Please respect the project by keeping the credits, (if it is too disturbing you can credit me in the \"about me\" of the bot discord)\n\t\t\t\ttext: `ticket.pm ${footer.trim() !== \"\" ? `- ${footer}` : \"\"}`, // Please respect the LICENSE :D\n\t\t\t\t// Please respect the project by keeping the credits, (if it is too disturbing you can credit me in the \"about me\" of the bot discord)\n\t\t\t\ticonURL: locale.getNoErrorSubValue(\"embeds\", \"ticketOpened\", \"footer\", \"iconUrl\")\n\t\t\t});\n\n\t\tconst row = new ActionRowBuilder<ButtonBuilder>();\n\n\t\tif (client.config.closeOption?.closeButton) {\n\t\t\tif (client.config.closeOption?.askReason) {\n\t\t\t\trow.addComponents(\n\t\t\t\t\tnew ButtonBuilder()\n\t\t\t\t\t\t.setCustomId(\"close_askReason\")\n\t\t\t\t\t\t.setLabel(locale.getSubValue(\"buttons\", \"close\", \"label\"))\n\t\t\t\t\t\t.setEmoji(locale.getSubValue(\"buttons\", \"close\", \"emoji\"))\n\t\t\t\t\t\t.setStyle(ButtonStyle.Danger)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\trow.addComponents(\n\t\t\t\t\tnew ButtonBuilder()\n\t\t\t\t\t\t.setCustomId(\"close\")\n\t\t\t\t\t\t.setLabel(locale.getSubValue(\"buttons\", \"close\", \"emoji\"))\n\t\t\t\t\t\t.setEmoji(locale.getSubValue(\"buttons\", \"close\", \"emoji\"))\n\t\t\t\t\t\t.setStyle(ButtonStyle.Danger)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (client.config.claimOption?.claimButton) {\n\t\t\trow.addComponents(\n\t\t\t\tnew ButtonBuilder()\n\t\t\t\t\t.setCustomId(\"claim\")\n\t\t\t\t\t.setLabel(locale.getSubValue(\"buttons\", \"claim\", \"label\"))\n\t\t\t\t\t.setEmoji(locale.getSubValue(\"buttons\", \"claim\", \"emoji\"))\n\t\t\t\t\t.setStyle(ButtonStyle.Primary)\n\t\t\t);\n\t\t}\n\n\t\tconst body = {\n\t\t\tembeds: [ticketOpenedEmbed],\n\t\t\tcontent: `<@${interaction.user.id}> ${\n\t\t\t\tclient.config.pingRoleWhenOpened ? client.config.roleToPingWhenOpenedId.map((x) => `<@&${x}>`).join(\", \") : \"\"\n\t\t\t}`,\n\t\t\tcomponents: [] as ActionRowBuilder<ButtonBuilder>[],\n\t\t};\n\n\t\tif (row.components.length > 0) body.components = [row];\n\n\t\tchannel\n\t\t\t.send(body)\n\t\t\t.then((msg) => {\n\t\t\t\tclient.prisma.tickets.create({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcategory: JSON.stringify(ticketType),\n\t\t\t\t\t\treason: allReasons,\n\t\t\t\t\t\tcreator: interaction.user.id,\n\t\t\t\t\t\tcreatedat: Date.now(),\n\t\t\t\t\t\tchannelid: channel.id,\n\t\t\t\t\t\tmessageid: msg.id\n\t\t\t\t\t}\n\t\t\t\t}).then(); // Again why tf do I need .then()?!?!?\n\t\t\t\tmsg.pin().then(() => {\n\t\t\t\t\tmsg.channel.bulkDelete(1);\n\t\t\t\t});\n\t\t\t\tinteraction\n\t\t\t\t\t.editReply({\n\t\t\t\t\t\tcontent: client.locales.getValue(\"ticketOpenedMessage\").replace(\"TICKETCHANNEL\", `<#${channel.id}>`),\n\t\t\t\t\t\tcomponents: [],\n\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => console.log(e));\n\n\t\t\t\tresolve(true);\n\t\t\t})\n\t\t\t.catch((e) => console.log(e));\n\t});\n};\n"]}